<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Explorer 2.8</title>

<style>
:root {
    --neon: #00f7ff;
    --bg: #05070f;
    --panel: #0c1225;
}

* {
    box-sizing: border-box;
    font-family: "Segoe UI", sans-serif;
}

body {
    margin: 0;
    height: 100vh;
    display: flex;
    background: radial-gradient(circle at top, #141b33, #05070f);
    color: white;
}

aside {
    width: 330px;
    background: var(--panel);
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

h2 {
    margin: 0;
    color: var(--neon);
    text-shadow: 0 0 12px var(--neon);
}

button {
    background: transparent;
    border: 1px solid var(--neon);
    color: var(--neon);
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
}

button:hover {
    background: var(--neon);
    color: black;
    box-shadow: 0 0 15px var(--neon);
}

.item {
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 6px;
    background: #0c1225;
    cursor: pointer;
}

.item:hover {
    background: #16204a;
}

.folder {
    border-left: 4px solid #7c7cff;
}

.drag-over {
    outline: 2px dashed var(--neon);
}

main {
    flex: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
}

input, textarea {
    background: #0b1020;
    border: 1px solid #1f2a4a;
    color: white;
    padding: 10px;
    border-radius: 8px;
}

textarea {
    flex: 1;
    resize: none;
}

/* CONTEXT MENU */
#context {
    position: fixed;
    display: none;
    background: #0b1020;
    border: 1px solid var(--neon);
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,247,255,0.6);
    z-index: 9999;
}

#context div {
    padding: 10px 14px;
    cursor: pointer;
}

#context div:hover {
    background: var(--neon);
    color: black;
}
</style>
</head>

<body>

<aside>
    <h2>Explorer 2.8</h2>
    <button onclick="newFolder()">ğŸ“ Nieuwe map</button>
    <button onclick="newDoc()">ğŸ“„ Nieuw document</button>
    <button onclick="showTrash()">ğŸ—‘ Prullenmand</button>
    <div id="explorer"></div>
</aside>

<main>
    <input id="title" placeholder="Document titel">
    <textarea id="content" placeholder="Typ hier..."></textarea>
    <button onclick="saveDoc()">ğŸ’¾ Opslaan</button>
</main>

<div id="context"></div>

<script>
let currentId = null;
let contextTarget = null;
let contextType = null;
let view = "explorer";

const load = k => JSON.parse(localStorage.getItem(k) || "[]");
const save = (k,v) => localStorage.setItem(k, JSON.stringify(v));

document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("click", () => context.style.display = "none");

/* AUTO CLEAN TRASH (30 dagen) */
(function(){
    let trash = load("trash");
    const now = Date.now();
    trash = trash.filter(t => now - t.deletedAt < 30*24*60*60*1000);
    save("trash", trash);
})();

function newFolder() {
    const name = prompt("Map naam");
    if (!name) return;
    const f = load("folders");
    f.push({ id: crypto.randomUUID(), name });
    save("folders", f);
    render();
}

function newDoc() {
    currentId = null;
    title.value = "";
    content.value = "";
}

function saveDoc() {
    if (!title.value) return alert("Titel nodig");
    const docs = load("docs");

    if (currentId) {
        const d = docs.find(d => d.id === currentId);
        d.title = title.value;
        d.content = content.value;
    } else {
        docs.push({
            id: crypto.randomUUID(),
            title: title.value,
            content: content.value,
            folderId: null
        });
    }
    save("docs", docs);
    render();
}

function openDoc(id) {
    const d = load("docs").find(d => d.id === id);
    currentId = id;
    title.value = d.title;
    content.value = d.content;
}

/* DRAG SYSTEM */
function dragStart(e, id) {
    e.dataTransfer.effectAllowed = "move";
    e.dataTransfer.setData("docId", id);
}

function dropDoc(e, folderId) {
    e.preventDefault();
    const id = e.dataTransfer.getData("docId");
    if (!id) return;
    const docs = load("docs");
    docs.find(d => d.id === id).folderId = folderId;
    save("docs", docs);
    render();
}

/* CONTEXT MENU */
function openContext(e, id, type) {
    e.preventDefault();
    contextTarget = id;
    contextType = type;

    context.innerHTML = `
        <div onclick="rename()">âœ Naam wijzigen</div>
        <div onclick="toTrash()">ğŸ—‘ Verplaats naar Prullenmand</div>
    `;

    if (type === "doc") {
        context.innerHTML += `<div onclick="removeFromFolder()">ğŸ“‚ Uit map halen</div>`;
    }

    context.style.left = e.clientX + "px";
    context.style.top = e.clientY + "px";
    context.style.display = "block";
}

function rename() {
    const name = prompt("Nieuwe naam");
    if (!name) return;

    if (contextType === "doc") {
        const d = load("docs");
        d.find(x => x.id === contextTarget).title = name;
        save("docs", d);
    } else {
        const f = load("folders");
        f.find(x => x.id === contextTarget).name = name;
        save("folders", f);
    }
    render();
}

function toTrash() {
    let trash = load("trash");

    if (contextType === "doc") {
        let docs = load("docs");
        const d = docs.find(x => x.id === contextTarget);
        docs = docs.filter(x => x.id !== contextTarget);
        save("docs", docs);
        trash.push({ type:"doc", data:d, deletedAt:Date.now() });
    } else {
        let folders = load("folders");
        const f = folders.find(x => x.id === contextTarget);
        folders = folders.filter(x => x.id !== contextTarget);
        save("folders", folders);

        const docs = load("docs").filter(d => d.folderId === contextTarget);
        save("docs", load("docs").filter(d => d.folderId !== contextTarget));

        trash.push({ type:"folder", data:{ folder:f, docs }, deletedAt:Date.now() });
    }

    save("trash", trash);
    render();
}

function removeFromFolder() {
    const docs = load("docs");
    docs.find(d => d.id === contextTarget).folderId = null;
    save("docs", docs);
    render();
}

/* PRULLENMAND */
function showTrash() {
    view = "trash";
    explorer.innerHTML = "<h3>ğŸ—‘ Prullenmand</h3>";
    load("trash").forEach(t => {
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = t.type === "doc"
            ? "ğŸ“„ " + t.data.title
            : "ğŸ“ " + t.data.folder.name;
        explorer.appendChild(div);
    });
}

/* RENDER */
function render() {
    view = "explorer";
    explorer.innerHTML = "";
    const folders = load("folders");
    const docs = load("docs");

    folders.forEach(f => {
        const div = document.createElement("div");
        div.className = "item folder";
        div.textContent = "ğŸ“ " + f.name;
        div.ondragover = e => e.preventDefault();
        div.ondrop = e => dropDoc(e, f.id);
        div.oncontextmenu = e => openContext(e, f.id, "folder");
        explorer.appendChild(div);

        docs.filter(d => d.folderId === f.id).forEach(d => {
            const doc = document.createElement("div");
            doc.className = "item";
            doc.textContent = "ğŸ“„ " + d.title;
            doc.draggable = true;
            doc.ondragstart = e => dragStart(e, d.id);
            doc.onclick = () => openDoc(d.id);
            doc.oncontextmenu = e => openContext(e, d.id, "doc");
            explorer.appendChild(doc);
        });
    });

    docs.filter(d => !d.folderId).forEach(d => {
        const doc = document.createElement("div");
        doc.className = "item";
        doc.textContent = "ğŸ“„ " + d.title;
        doc.draggable = true;
        doc.ondragstart = e => dragStart(e, d.id);
        doc.onclick = () => openDoc(d.id);
        doc.oncontextmenu = e => openContext(e, d.id, "doc");
        explorer.appendChild(doc);
    });
}

render();
</script>

</body>
</html>
